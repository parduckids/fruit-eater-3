<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRUIT EATER 3</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }

        .game-container {
            position: relative;
            width: 600px;
            height: 600px;
            border: 5px solid #333;
            background-color: #fff;
            overflow: hidden;
        }

        #square {
            width: 75px;
            height: 75px;
            background-color: transparent;
            position: absolute;
            z-index: 10;
        }

        #debug {
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .emoji {
            font-size: 30px;
            position: absolute;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
        }

        #flag {
            font-size: 50px;
            position: absolute;
            display: none;
        }

        .game-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-family: "Press Start 2P", system-ui;
            font-weight: 400;
            font-style: normal;
        }

        .instructions {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            transition: opacity 0.5s ease-out;
            font-family: "Press Start 2P", system-ui;
            font-weight: 400;
            font-style: normal;
        }
    </style>
</head>

<body>
    <h2 class="game-title">FRUIT EATER 3</h2>
    <p class="instructions" id="instructions">Use arrow keys to move your baby face</p>
    <div class="game-container">
        <div id="square"><img src="master-crok.png" width="75px" height="auto" alt=""></div>
        <div id="debug"></div>
        <div class="emoji fruit" id="apple" style="top: 400px; left: 100px;">üçé</div>
        <div class="emoji fruit" id="banana" style="top: 150px; left: 300px;">üçå</div>
        <div class="emoji fruit" id="cherry" style="top: 250px; left: 200px;">üçí</div>
        <div class="emoji fruit" id="strawberry" style="top: 100px; left: 400px;">üçì</div>
        <div class="emoji fruit" id="orange" style="top: 300px; left: 50px;">üçä</div>
        <div id="flag" style="top:350px; left:350px">üèÅ</div>
    </div>

    <script>
        const square = document.getElementById('square');
        const debug = document.getElementById('debug');
        const flag = document.getElementById('flag');
        const instructions = document.getElementById('instructions');
        let squareTop = 100;
        let squareLeft = 100;
        const collectedEmojis = new Set();
        let gameEnded = false;
        let twistRevealed = false;
        let firstKeyPress = true;

        function updateSquarePosition() {
            square.style.top = squareTop + 'px';
            square.style.left = squareLeft + 'px';
            checkCollisions();
            updateDebugInfo();
            checkGameEnd();
        }

        function checkCollisions() {
            const emojis = document.getElementsByClassName('emoji');
            for (let emoji of emojis) {
                if (isColliding(square, emoji) && !collectedEmojis.has(emoji.id)) {
                    collectedEmojis.add(emoji.id);
                    emoji.style.opacity = '0.2';
                }
            }

            if (flag.style.display === 'block' && isColliding(square, flag)) {
                endGame();
            }
        }

        function isColliding(a, b) {
            const aRect = a.getBoundingClientRect();
            const bRect = b.getBoundingClientRect();

            const squareCollisionSize = 30;
            const aCollisionLeft = aRect.left + (aRect.width - squareCollisionSize) / 2;
            const aCollisionTop = aRect.top + (aRect.height - squareCollisionSize) / 2;

            return !(
                aCollisionTop + squareCollisionSize < bRect.top ||
                aCollisionTop > bRect.top + bRect.height ||
                aCollisionLeft + squareCollisionSize < bRect.left ||
                aCollisionLeft > bRect.left + bRect.width
            );
        }

        function updateDebugInfo() {
            const collectedItems = Array.from(collectedEmojis).map(id => twistRevealed ? 'poop' : id);
            debug.innerHTML = `CONSUMED:  ${collectedItems.join(', ')}`;
        }

        function checkGameEnd() {
            const fruits = document.getElementsByClassName('fruit');
            if (collectedEmojis.size >= fruits.length && !gameEnded) {
                flag.style.display = 'block';
            }
        }

        function changeName() {
            document.querySelector('.game-title').textContent = 'POOP EATER 3';
        }

        function endGame() {
            gameEnded = true;
            if (confirm("You ate all the fruits! good job!  \n Click 'Ok' to continue!")) {
                alert("Actually! It was all poop, you poopeater hahahahahahaha");
                revealTwist();
            }
        }

        function revealTwist() {
            twistRevealed = true;
            const fruits = document.getElementsByClassName('fruit');
            for (let fruit of fruits) {
                fruit.textContent = 'üí©';
                fruit.style.opacity = '1';
            }
            updateDebugInfo();
            changeName()
        }

        let lastKey = 'None';

        document.addEventListener('keydown', (event) => {
            if (gameEnded) return;

            if (firstKeyPress) {
                instructions.style.opacity = '0';
                firstKeyPress = false;
            }

            lastKey = event.key;
            const step = 5;

            switch (event.key) {
                case 'ArrowUp':
                    squareTop = Math.max(0, squareTop - step);
                    break;
                case 'ArrowDown':
                    squareTop = Math.min(525, squareTop + step);
                    break;
                case 'ArrowLeft':
                    squareLeft = Math.max(0, squareLeft - step);
                    break;
                case 'ArrowRight':
                    squareLeft = Math.min(525, squareLeft + step);
                    break;
                default:
                    return;
            }

            updateSquarePosition();
            event.preventDefault();
        });

        // current position
        updateSquarePosition();
    </script>
</body>

</html>