<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRUIT EATER 3</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            padding: 20px;
            box-sizing: border-box;
            font-family: "Press Start 2P", system-ui;
        }

        .game-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            aspect-ratio: 1 / 1;
            border: 5px solid #333;
            background-color: #fff;
            overflow: hidden;
        }

        #square {
            width: 12.5%;
            height: 12.5%;
            background-color: transparent;
            position: absolute;
            z-index: 10;
        }

        #square img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        #debug {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 12px;
        }

        .emoji {
            font-size: 5vw;
            position: absolute;
            width: 5vw;
            height: 5vw;
            text-align: center;
            line-height: 5vw;
        }

        #flag {
            font-size: 8vw;
            position: absolute;
            display: none;
        }

        .game-title {
            font-size: 6vw;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 400;
            font-style: normal;
        }

        .instructions {
            font-size: 2.5vw;
            margin-bottom: 1rem;
            transition: opacity 0.5s ease-out;
            text-align: center;
            font-weight: 400;
            font-style: normal;
        }

        .touch-buttons {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
            width: 100%;
            max-width: 200px;
        }

        .touch-buttons button {
            font-size: 24px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.7);
            border: 2px solid #333;
            border-radius: 5px;
        }

        .touch-buttons #up {
            grid-column: 2;
        }

        .touch-buttons #left {
            grid-column: 1;
            grid-row: 2;
        }

        .touch-buttons #right {
            grid-column: 3;
            grid-row: 2;
        }

        .touch-buttons #down {
            grid-column: 2;
            grid-row: 3;
        }

        @media (min-width: 768px) {
            .game-title {
                font-size: 2.5rem;
            }

            .instructions {
                font-size: 1.2rem;
            }

            .emoji {
                font-size: 30px;
                width: 30px;
                height: 30px;
                line-height: 30px;
            }

            #flag {
                font-size: 50px;
            }
        }

        @media (max-width: 767px) {
            body {
                padding: 10px;
            }

            .game-container {
                max-width: 90vw;
                aspect-ratio: 1 / 1;
            }

            .game-title {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }

            .instructions {
                font-size: 0.8rem;
                margin-bottom: 0.5rem;
            }

            .touch-buttons {
                max-width: 180px;
            }

            .touch-buttons button {
                font-size: 28px;
                padding: 12px;
            }

            .emoji {
                font-size: 7vw;
                width: 7vw;
                height: 7vw;
                line-height: 7vw;
            }

            #flag {
                font-size: 10vw;
            }

            #square {
                width: 15%;
                height: 15%;
            }
        }
    </style>
</head>

<body>
    <h2 class="game-title">FRUIT EATER 3</h2>
    <p class="instructions" id="instructions">Use arrow keys to move your baby face</p>
    <div class="game-container">
        <div id="square"><img src="master-crok.png" alt=""></div>
        <div id="debug"></div>
        <div class="emoji fruit" id="apple" style="top: 66.67%; left: 16.67%;">üçé</div>
        <div class="emoji fruit" id="banana" style="top: 25%; left: 50%;">üçå</div>
        <div class="emoji fruit" id="cherry" style="top: 41.67%; left: 33.33%;">üçí</div>
        <div class="emoji fruit" id="strawberry" style="top: 16.67%; left: 66.67%;">üçì</div>
        <div class="emoji fruit" id="orange" style="top: 50%; left: 8.33%;">üçä</div>
        <div id="flag" style="top:58.33%; left:58.33%">üèÅ</div>
    </div>

    <script>
        const square = document.getElementById('square');
        const debug = document.getElementById('debug');
        const flag = document.getElementById('flag');
        const instructions = document.getElementById('instructions');
        const gameContainer = document.querySelector('.game-container');
        let squareTop = 16.67;
        let squareLeft = 16.67;
        const collectedEmojis = new Set();
        let gameEnded = false;
        let twistRevealed = false;
        let firstKeyPress = true;
        let movementInterval = null;
        const movementSpeed = 50; // Milliseconds between movements

        function updateSquarePosition() {
            square.style.top = squareTop + '%';
            square.style.left = squareLeft + '%';
            checkCollisions();
            updateDebugInfo();
            checkGameEnd();
        }

        function checkCollisions() {
            const emojis = document.getElementsByClassName('emoji');
            for (let emoji of emojis) {
                if (isColliding(square, emoji) && !collectedEmojis.has(emoji.id)) {
                    collectedEmojis.add(emoji.id);
                    emoji.style.opacity = '0.2';
                }
            }

            if (flag.style.display === 'block' && isColliding(square, flag)) {
                endGame();
            }
        }

        function isColliding(a, b) {
            const aRect = a.getBoundingClientRect();
            const bRect = b.getBoundingClientRect();

            const squareCollisionSize = aRect.width * 0.4;
            const aCollisionLeft = aRect.left + (aRect.width - squareCollisionSize) / 2;
            const aCollisionTop = aRect.top + (aRect.height - squareCollisionSize) / 2;

            return !(
                aCollisionTop + squareCollisionSize < bRect.top ||
                aCollisionTop > bRect.top + bRect.height ||
                aCollisionLeft + squareCollisionSize < bRect.left ||
                aCollisionLeft > bRect.left + bRect.width
            );
        }

        function updateDebugInfo() {
            const collectedItems = Array.from(collectedEmojis).map(id => twistRevealed ? 'poop' : id);
            debug.innerHTML = `CONSUMED:  ${collectedItems.join(', ')}`;
        }

        function checkGameEnd() {
            const fruits = document.getElementsByClassName('fruit');
            if (collectedEmojis.size >= fruits.length && !gameEnded) {
                flag.style.display = 'block';
            }
        }

        function changeName() {
            document.querySelector('.game-title').textContent = 'POOP EATER 3';
        }

        function endGame() {
            gameEnded = true;
            if (confirm("You ate all the fruits! good job!  \n Click 'Ok' to continue!")) {
                alert("Actually! It was all poop, you poopeater hahahahahahaha");
                revealTwist();
            }
        }

        function revealTwist() {
            twistRevealed = true;
            const fruits = document.getElementsByClassName('fruit');
            for (let fruit of fruits) {
                fruit.textContent = 'üí©';
                fruit.style.opacity = '1';
            }
            updateDebugInfo();
            changeName()
        }

        function moveSquegglyMan(direction) {
            const step = 0.83;
            switch (direction) {
                case 'up':
                    squareTop = Math.max(0, squareTop - step);
                    break;
                case 'down':
                    squareTop = Math.min(87.5, squareTop + step);
                    break;
                case 'left':
                    squareLeft = Math.max(0, squareLeft - step);
                    break;
                case 'right':
                    squareLeft = Math.min(87.5, squareLeft + step);
                    break;
            }
            updateSquarePosition();
        }

        function startContinuousMovement(direction) {
            if (movementInterval) clearInterval(movementInterval);
            movementInterval = setInterval(() => {
                moveSquegglyMan(direction);
            }, movementSpeed);
        }

        function stopContinuousMovement() {
            if (movementInterval) {
                clearInterval(movementInterval);
                movementInterval = null;
            }
        }

        document.addEventListener('keydown', (event) => {
            if (gameEnded) return;

            if (firstKeyPress) {
                instructions.style.opacity = '0';
                firstKeyPress = false;
            }

            switch (event.key) {
                case 'ArrowUp':
                    moveSquegglyMan('up');
                    break;
                case 'ArrowDown':
                    moveSquegglyMan('down');
                    break;
                case 'ArrowLeft':
                    moveSquegglyMan('left');
                    break;
                case 'ArrowRight':
                    moveSquegglyMan('right');
                    break;
                default:
                    return;
            }

            event.preventDefault();
        });

        function isTouchDevice() {
            return ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0);
        }

        function addTouchButtons() {
            if (!isTouchDevice()) return;

            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'touch-buttons';
            buttonContainer.innerHTML = `
                <button id="up">‚¨ÜÔ∏è</button>
                <button id="left">‚¨ÖÔ∏è</button>
                <button id="right">‚û°Ô∏è</button>
                <button id="down">‚¨áÔ∏è</button>
            `;
            document.body.appendChild(buttonContainer);

            const buttons = buttonContainer.getElementsByTagName('button');
            for (let button of buttons) {
                button.addEventListener('touchstart', handleTouchButtonStart);
                button.addEventListener('touchend', handleTouchButtonEnd);
                button.addEventListener('touchcancel', handleTouchButtonEnd);
            }

            // Show the buttons
            buttonContainer.style.display = 'grid';

            // Update instructions for touch devices
            instructions.textContent = "Use buttons to move your baby face";
        }

        function handleTouchButtonStart(event) {
            event.preventDefault();
            const direction = event.target.id;
            moveSquegglyMan(direction);
            startContinuousMovement(direction);
        }

        function handleTouchButtonEnd(event) {
            event.preventDefault();
            stopContinuousMovement();
        }

        // Initialize the game
        updateSquarePosition();
        window.addEventListener('load', addTouchButtons);
    </script>
</body>

</html>